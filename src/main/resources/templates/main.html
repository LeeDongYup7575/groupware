<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ê·¸ë£¹ì›¨ì–´ ì‹œìŠ¤í…œ - ëŒ€ì‹œë³´ë“œ</title>

  <!-- í°íŠ¸ ë° ì•„ì´ì½˜ -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.c  om/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <!-- ë©”ì¸ í˜ì´ì§€ CSS -->
  <link rel="stylesheet" th:href="@{/assets/css/main-page.css}">

  <!-- í—¤ë” ì—ì…‹ í¬í•¨ -->
  <th:block th:replace="fragments/header :: headerAssets"></th:block>

  <!-- ì‚¬ì´ë“œë°” ìŠ¤íƒ€ì¼ í¬í•¨ -->
  <link rel="stylesheet" th:href="@{/assets/css/fragments/sidebar-common.css}">

  <script src="https://unpkg.com/fullcalendar@6.1.8/index.global.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fullcalendar/google-calendar@6.1.8/index.global.min.js"></script>

</head>
<body>



<!-- í—¤ë” í¬í•¨ -->
<div th:replace="fragments/header :: header"></div>

<div class="main-container">
  <!-- ì‚¬ì´ë“œë°” -->
  <div th:replace="fragments/sidebar/main-sidebar :: sidebar"></div>

  <!-- ë©”ì¸ ì½˜í…ì¸  -->
  <div class="main-content">
    <!-- í”„ë¡œí•„ ë° ê²Œì‹œíŒ ì„¹ì…˜ -->
    <div class="dashboard-row">
      <div class="dashboard-section section-left">
        <div class="profile-card">
          <div class="profile-header">
            <div class="profile-image">
              <img th:src="${employee.profileImgUrl}" alt="í”„ë¡œí•„ ì´ë¯¸ì§€">
            </div>
            <div class="profile-name">
              <h3 th:text="${employee.name + ' ' + employee.positionTitle}"></h3>
              <p th:text="${employee.departmentName}"></p>
            </div>
          </div>

          <div class="profile-stats">
            <div class="stat-item">
              <div class="stat-label">ê²°ì¬í•  ë¬¸ì„œ</div>
              <div class="stat-value" th:text="${edsmCount}"></div>
            </div>
            <div class="stat-item">
              <div class="stat-label">ë‚´ ì˜ˆì•½/ëŒ€ì—¬ í˜„í™©</div>
              <div class="stat-value" th:text="${myBookingsCount}"></div>
            </div>
          </div>
        </div>
      </div>

      <div class="dashboard-section section-right">
        <h4 class="card-title">ê²Œì‹œíŒ</h4>

        <div class="tabs-container">
          <div class="tabs-navigation">
            <button class="tab-button active" data-tab="notice">ì‚¬ë‚´ê³µì§€</button>
            <button class="tab-button" data-tab="free">ììœ ê²Œì‹œíŒ</button>
          </div>

          <div id="notice" class="tab-content active">
            <!-- ê³µì§€ì‚¬í•­ì´ ìˆëŠ” ê²½ìš° -->
            <div th:if="${!notices.isEmpty()}">
              <div class="list-group">
                <a th:each="notice, index : ${notices}"
                   th:href="${notice.url}"
                   th:text="${notice.title}"
                   class="list-group-item list-group-item-action"
                   target="_blank">
                  ê³µì§€ì‚¬í•­ ì œëª©
                </a>
              </div>
            </div>

            <!-- ê³µì§€ì‚¬í•­ì´ ì—†ëŠ” ê²½ìš° -->
            <div th:if="${notices.isEmpty()}" class="alert">
              í‘œì‹œí•  ê³µì§€ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.
            </div>
          </div>

          <div id="free" class="tab-content">
            <div th:if="${!publicList.isEmpty()}">
              <div class="list-group">
                <a th:each="post : ${publicList}"
                   th:href="@{/board/post/{id}(id=${post.id})}"
                   class="list-group-item list-group-item-action"
                   target="_blank"
                   style="display: flex; justify-content: space-between; align-items: center;">

                  <span th:text="${post.title}">ì œëª©</span>
                  <span th:text="${post.author}" style="font-size: 0.85em; color: #666;">ì‘ì„±ì</span>
                </a>


              </div>
            </div>

            <div th:if="${publicList.isEmpty()}" class="alert">
              í‘œì‹œí•  ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ê·¼íƒœ ë° íšŒì˜ì‹¤ ì˜ˆì•½ ì„¹ì…˜ -->
    <div class="dashboard-row">
      <div class="dashboard-section section-left">
        <h4 class="card-title">ê·¼íƒœê´€ë¦¬</h4>
        <p class="date-info" id="current-time">2025ë…„ 03ì›” 26ì¼ (í™”) 10:56:43</p>

        <div class="attendance-info">
          <div class="attendance-row">
            <div class="attendance-label">ì¶œê·¼ì‹œê°„</div>
            <div class="attendance-value"
                 th:each="attendance : ${attendanceListByDate}"
                 th:if="${attendance.checkIn != null}" th:text="${attendance.checkIn}">
            </div>
          </div>
          <div class="attendance-row">
            <div class="attendance-label">í‡´ê·¼ì‹œê°„</div>
            <div class="attendance-value"
                 th:each="attendance : ${attendanceListByDate}"
                 th:if="${attendance.checkOut != null}" th:text="${attendance.checkOut}">
            </div>
          </div>
        </div>


      </div>

      <div class="dashboard-section section-right">
        <h4 class="card-title">íšŒì˜ì‹¤ ì˜ˆì•½ í˜„í™©</h4>
        <div class="timetable-container">
          <table class="timetable">
            <thead>
            <tr>
              <th></th>
              <th>09:00</th>
              <th>10:00</th>
              <th>11:00</th>
              <th>12:00</th>
              <th>13:00</th>
              <th>14:00</th>
              <th>15:00</th>
              <th>16:00</th>
              <th>17:00</th>
              <th>18:00</th>
            </tr>
            </thead>
            <tbody>
            <!-- íšŒì˜ì‹¤ë³„ ì˜ˆì•½ í˜„í™© í‘œì‹œ -->
            <tr th:each="roomNumber : ${#numbers.sequence(1, 4)}">
              <td th:text="${'íšŒì˜ì‹¤'+roomNumber}">íšŒì˜ì‹¤</td>
              <td colspan="6" style="position: relative;">
                <!-- í•´ë‹¹ íšŒì˜ì‹¤ì˜ ì˜ˆì•½ë§Œ í•„í„°ë§í•˜ì—¬ í‘œì‹œ -->
                <div th:each="booking : ${meetingRoomBookings}"
                     th:if="${booking.roomId == roomNumber}"
                     class="reservation-bar"
                     th:style="${'width: ' + bookingUtils.calculateWidth(booking) + '%; left: ' + bookingUtils.calculatePosition(booking) + '%; background-color: ' + bookingUtils.getBookingColor(booking)}">
                  <span th:text="${@stringUtils.removeFirstNChars(bookingUtils.formatBookingTime(booking), 3)}">ì˜ˆì•½ ì‹œê°„</span>


                </div>
              </td>
            </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- ìº˜ë¦°ë” -->
    <div class="dashboard-row">
      <div class="dashboard-section section-left">
        <div class="calendar-wrapper">
          <div id='calendar'></div>
        </div>

      </div>
      <!-- í”„ë¡œí•„ ë° ê²Œì‹œíŒ ì„¹ì…˜ -->
<!--      <div class="profile-stats">-->
<!--        <div class="stat-item">-->
<!--          <div class="stat-label">ê²°ì¬í•  ë¬¸ì„œ</div>-->
<!--          <div class="stat-value" th:text="${pendingApprovals != null ? pendingApprovals : '0'}">6</div>-->
<!--        </div>-->
<!--        <div class="stat-item">-->
<!--          <div class="stat-label">ë‚´ ì˜ˆì•½/ëŒ€ì—¬ í˜„í™©</div>-->
<!--          <div class="stat-value" th:text="${myBookingsCount}">1</div>-->
<!--        </div>-->
<!--      </div>-->
    </div>
  </div>
</div>

<!-- í˜ì´ì§€ ìŠ¤í¬ë¦½íŠ¸ -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // íƒ­ ì „í™˜ ê¸°ëŠ¥
    const tabButtons = document.querySelectorAll('.tab-button');

    tabButtons.forEach(button => {
      button.addEventListener('click', function() {
        // ëª¨ë“  íƒ­ ë¹„í™œì„±í™”
        tabButtons.forEach(btn => btn.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

        // í´ë¦­ëœ íƒ­ í™œì„±í™”
        this.classList.add('active');
        const tabId = this.getAttribute('data-tab');
        document.getElementById(tabId).classList.add('active');
      });
    });

      var calendarEl = document.getElementById('calendar');

      var calendar = new FullCalendar.Calendar(calendarEl, {
        googleCalendarApiKey: 'AIzaSyAmxOp9PrC83LxO6JmGFH3_rfhvpzOXiy8',
        initialView: 'dayGridMonth',
        locale: 'ko', // í•œêµ­ì–´ ì„¤ì •
        headerToolbar: {
          left: 'prev,next today',
          center: 'title',
          right: 'dayGridMonth,listMonth'
        },eventSources: [
                {
          googleCalendarId: 'ko.south_korea#holiday@group.v.calendar.google.com',
          className: 'korean-holiday'
        },
          {
            events: [
              {
                title: 'íšŒì‚¬ì°½ë¦½ì¼ ğŸ‰',
                start: '2025-04-24', // ì›í•˜ëŠ” ë‚ ì§œ (YYYY-MM-DD)
                allDay: true,
                className: 'company-anniversary' // ì›í•˜ëŠ” ìŠ¤íƒ€ì¼ì„ ìœ„í•´ í´ë˜ìŠ¤ ì¶”ê°€ ê°€ëŠ¥
              }
            ]
          }
        ],

        eventClick: function(info) {
          info.jsEvent.preventDefault();
          alert(info.event.title);
        }
      });

      calendar.render();

  });

  function updateTime() {
    var currentDate = new Date();
    var year = currentDate.getFullYear();
    var month = (currentDate.getMonth() + 1).toString().padStart(2, '0');
    var date = currentDate.getDate().toString().padStart(2, '0');
    var day = currentDate.toLocaleString('ko-KR', { weekday: 'long' });
    var hours = currentDate.getHours().toString().padStart(2, '0');
    var minutes = currentDate.getMinutes().toString().padStart(2, '0');
    var seconds = currentDate.getSeconds().toString().padStart(2, '0');

    var formattedTime = `${year}ë…„ ${month}ì›” ${date}ì¼ (${day}) ${hours}:${minutes}:${seconds}`;
    document.getElementById('current-time').textContent = formattedTime;
  }

  // 1ì´ˆë§ˆë‹¤ updateTime í•¨ìˆ˜ ì‹¤í–‰
  setInterval(updateTime, 1000);


</script>

<!-- í—¤ë” ê´€ë ¨ ìŠ¤í¬ë¦½íŠ¸ í¬í•¨ -->
<div th:replace="fragments/header :: headerScripts"></div>

<!-- ê³µí†µ ì‚¬ì´ë“œë°” ìŠ¤í¬ë¦½íŠ¸ í¬í•¨ -->
<link rel="stylesheet" th:href="@{/assets/js/fragments/sidebar-common.js}">

</body>
</html>